<!DOCTYPE html>
<!-- saved from url=(0083)https://www.petercollingridge.co.uk/tutorials/pygame-physics-simulation/collisions/ -->
<html class="no-js" scrolltop="NaN"><!--<![endif]--><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta name="author" content="Peter Collingridge">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">

        <title>Collisions</title>
        
        <meta property="og:site_name" content="petercollingridge.co.uk">
        <meta property="og:type" content="website"> 
        <meta property="og:url" content="http://petercollingridge.co.uk/tutorials/pygame-physics-simulation/collisions/">
        <meta property="og:title" content="Collisions">

      

      

        

        
        <link rel="stylesheet" href="./Collisions_files/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">
        <link rel="stylesheet" href="./Collisions_files/font-awesome.min.bf0c425cdb73.css">
        <link rel="stylesheet" type="text/css" href="./Collisions_files/base.5b0ea2f049b9.css">
        <link href="./Collisions_files/css" rel="stylesheet" type="text/css">
        <link rel="shortcut icon" href="https://wagtail.petercollingridge.co.uk/favicon.ico">

        
    <link rel="stylesheet" type="text/css" href="./Collisions_files/ajaxcomments.css">

        
        
    
    <link rel="stylesheet" type="text/css" href="./Collisions_files/prettify.css"></head>

    <body class="article-body" scrolltop="NaN">
        <div id="body">
            

            <nav class="navbar navbar-expand-md navbar-dark fixed-top">
              <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
              </button>

              <div class="collapse navbar-collapse" id="navbarsExampleDefault">
                <ul class="navbar-nav mr-auto">
                  <li class="nav-item active"><a class="nav-link" href="https://www.petercollingridge.co.uk/">
                    <i class="navbar-brand fa fa-home"></i> <span class="sr-only">(current)</span>
                  </a></li>
                  <li class="nav-item"><a class="nav-link" href="https://www.petercollingridge.co.uk/tutorials">Tutorials</a></li>
                  <li class="nav-item"><a class="nav-link" href="https://www.petercollingridge.co.uk/blog">Articles</a></li>
                  <li class="nav-item"><a class="nav-link" href="https://www.petercollingridge.co.uk/tools">Tools</a></li>
                  <li class="nav-item"><a class="nav-link" href="https://www.petercollingridge.co.uk/about">About</a></li>
                </ul>
                <form class="form-inline my-2 my-lg-0" action="https://www.petercollingridge.co.uk/search/" method="get">
                  <input class="form-control mr-sm-2" type="text" name="query" value="" placeholder="Search" aria-label="Search">
                  <button class="btn btn-outline my-2 my-sm-0" type="submit">Search</button>
                </form>
              </div>
            </nav>

            <main role="main" class="container">
              <h1>Collisions</h1>
              <div class="content">

    <div class="row">
    <div class="col-4">
        
            <a href="https://www.petercollingridge.co.uk/tutorials/pygame-physics-simulation/mouse-interactions/">
                <span class="naviagation-arrow"><i class="fa fa-caret-left" aria-hidden="true"></i></span>
                <span class="navigation-name">Mouse interactions</span>
            </a>
        
    </div>
    <div class="col-4 parent-page-link">
        <a href="https://www.petercollingridge.co.uk/tutorials/pygame-physics-simulation/">
            
                Pygame physics simulation
            
        </a>
    </div>
    <div class="col-4 next-page-link">
        
            <a href="https://www.petercollingridge.co.uk/tutorials/pygame-physics-simulation/mass/">
                <span class="navigation-name">Mass</span>
                <span class="naviagation-arrow"><i class="fa fa-caret-right" aria-hidden="true"></i></span>
            </a>
        
    </div>
</div>

    <hr>

    
    <div class="info-header">
        
            <span class="date">20 Sep 2010</span>
        

        
            <span class="github-link">
                <a href="https://github.com/petercollingridge/code-for-blog/tree/master/pygame%20physics%20simulation/particle_tutorial_8" target="_blank">
                    <i class="fa fa-github"></i> <span>Code on Github</span>
                </a>
            </span>
        
    </div>


    <article>
        


    
        
            <h2>Introduction</h2>
        
    
        
            <section class="section-block block-paragraph">
                <div class="rich-text"><p>In the previous tutorial we allowed the user to interact with the particles, but the particles didn't interact with one another. Now it's time to make them more tangible. In this tutorial, we will:</p><ul><li>Test whether any two particles have collided</li><li>Make particles that have collided bounce</li><li>Prevent colliding particles from sticking to one another</li></ul><p>Things start to get complex once we have multiple particles interacting with one another. In fact, it's <a href="https://en.wikipedia.org/wiki/N-body_problem">mathematically impossible</a> to solve the equations describing three or more interacting objects. In our simulation we'll have to make some simplifications, which we make it 'inaccurate', however, it should still represent a reasonable approximation to reality.</p></div>
            </section>
        
    
        
            <h2>Collision testing</h2>
        
    
        
            <section class="section-block block-paragraph">
                <div class="rich-text"><p>Firstly, we want to check whether any two particles overlap with one other, so we need to compare every particle with every other of particle. We can do this with a nested for loop. Since we already have one loop going through the particle array, we can use that.</p></div>
            </section>
        
    
        
            <section class="section-block block-code_block">
                <pre class="prettyprint linenums:104 prettyprinted" style=""><ol class="linenums"><li value="104" class="L3"><code class="language-python"><span class="kwd">for</span><span class="pln"> i</span><span class="pun">,</span><span class="pln"> particle </span><span class="kwd">in</span><span class="pln"> enumerate</span><span class="pun">(</span><span class="pln">my_particles</span><span class="pun">):</span></code></li><li class="L4"><code class="language-python"><span class="pln">    particle</span><span class="pun">.</span><span class="pln">move</span><span class="pun">()</span></code></li><li class="L5"><code class="language-python"><span class="pln">    particle</span><span class="pun">.</span><span class="pln">bounce</span><span class="pun">()</span></code></li><li class="L6"><code class="language-python"><span class="pln">    </span><span class="kwd">for</span><span class="pln"> particle2 </span><span class="kwd">in</span><span class="pln"> my_particles</span><span class="pun">[</span><span class="pln">i</span><span class="pun">+</span><span class="lit">1</span><span class="pun">:]:</span></code></li><li class="L7"><code class="language-python"><span class="pln">        collide</span><span class="pun">(</span><span class="pln">particle</span><span class="pun">,</span><span class="pln"> particle2</span><span class="pun">)</span></code></li><li class="L8"><code class="language-python"><span class="pln">    particle</span><span class="pun">.</span><span class="pln">display</span><span class="pun">()</span></code></li></ol></pre>
            </section>
        
    
        
            <section class="section-block block-paragraph">
                <div class="rich-text"><p>Note that the second loop is not a full loop; if we had two full loops, we'd compare every particle to every other particle twice over (and compare each particle to itself). Instead, we compare each particle with every particle with a higher index than it in the array. We therefore need to know the index of the current particle which we can get using <b>enumerate</b>. We use this value (i) to slice the <b>my_particle</b> array from i + 1 to the end to construct the second loop.</p></div>
            </section>
        
    
        
            <div class="row">
    <div class="col-md-6 two-col-block left-block">
        


    
        
            <section class="section-block block-paragraph">
                <div class="rich-text"><p>Now we need to actually define the <b>collide()</b> function. The first thing the function has to do is to test whether the two particles have collided. This is very simple as the particles are circles. We simply to measure the distance between them (using <b>math.hypot()</b> again) and test whether this value is less than their combined radius.</p></div>
            </section>
        
    

    </div>
    <div class="col-md-6 two-col-block right-block">
        


    
        
            <pre class="prettyprint linenums:26 prettyprinted" style=""><ol class="linenums"><li value="26" class="L5"><code class="language-python"><span class="kwd">def</span><span class="pln"> collide</span><span class="pun">(</span><span class="pln">p1</span><span class="pun">,</span><span class="pln"> p2</span><span class="pun">):</span></code></li><li class="L6"><code class="language-python"><span class="pln">    dx </span><span class="pun">=</span><span class="pln"> p1</span><span class="pun">.</span><span class="pln">x </span><span class="pun">-</span><span class="pln"> p2</span><span class="pun">.</span><span class="pln">x</span></code></li><li class="L7"><code class="language-python"><span class="pln">    dy </span><span class="pun">=</span><span class="pln"> p1</span><span class="pun">.</span><span class="pln">y </span><span class="pun">-</span><span class="pln"> p2</span><span class="pun">.</span><span class="pln">y</span></code></li><li class="L8"><code class="language-python"><span class="pln">    </span></code></li><li class="L9"><code class="language-python"><span class="pln">    distance </span><span class="pun">=</span><span class="pln"> math</span><span class="pun">.</span><span class="pln">hypot</span><span class="pun">(</span><span class="pln">dx</span><span class="pun">,</span><span class="pln"> dy</span><span class="pun">)</span></code></li><li class="L0"><code class="language-python"><span class="pln">    </span><span class="kwd">if</span><span class="pln"> distance </span><span class="pun">&lt;</span><span class="pln"> p1</span><span class="pun">.</span><span class="pln">size </span><span class="pun">+</span><span class="pln"> p2</span><span class="pun">.</span><span class="pln">size</span><span class="pun">:</span></code></li><li class="L1"><code class="language-python"><span class="pln">        </span><span class="kwd">print</span><span class="pln"> </span><span class="str">'Bang!'</span></code></li></ol></pre>
        
    

    </div>
</div>
        
    
        
            <section class="section-block block-paragraph">
                <div class="rich-text"><p>So far all that happens when two particles collide is that we print 'Bang!'. I'll complete the function as soon as I get a chance.</p></div>
            </section>
        
    
        
            <h2>The angle of collision</h2>
        
    
        
            <div class="row">
    <div class="col-md-7 two-col-block left-block">
        


    
        
            <section class="section-block block-paragraph">
                <div class="rich-text"><p>When two particles collide, we want them bounce off each other. Theoretically, when two circular particles collide they contact at an infinitely small point. The angle of this point is the tangent of the particle at this point. As the diagram below I hope shows, this angle is perpendicular to the line that joins the centre of the two particles.</p></div>
            </section>
        
    

    </div>
    <div class="col-md-5 two-col-block right-block">
        


    
        
            <section class="section-block block-img">
                <img alt="Diagram of how to calculate the angle of collision" class="img-responsive" height="400" src="./Collisions_files/colliding_particles.width-300.png" width="300">
            </section>
        
    

    </div>
</div>
        
    
        
            <div class="row">
    <div class="col-md-7 two-col-block left-block">
        


    
        
            <section class="section-block block-paragraph">
                <div class="rich-text"><p>We can treat the collision as though the particles were bouncing off a flat surface with the angle of the tangent. We can find the angle of the tangent with the following code:</p></div>
            </section>
        
    

    </div>
    <div class="col-md-5 two-col-block right-block">
        


    
        
            <pre class="prettyprint linenums:32 prettyprinted" style=""><ol class="linenums"><li value="32" class="L1"><code class="language-python"><span class="pln">tangent </span><span class="pun">=</span><span class="pln"> math</span><span class="pun">.</span><span class="pln">atan2</span><span class="pun">(</span><span class="pln">dy</span><span class="pun">,</span><span class="pln"> dx</span><span class="pun">)</span></code></li></ol></pre>
        
    

    </div>
</div>
        
    
        
            <div class="row">
    <div class="col-md-7 two-col-block left-block">
        


    
        
            <section class="section-block block-paragraph">
                <div class="rich-text"><p>To reflect the angle of the particles on this surface, we subtract their current angle from two times the tangent. I'll have to explain the logic behind this at a later date. It's at this point that knowing the angle that our particle is travelling starts to become useful.</p></div>
            </section>
        
    

    </div>
    <div class="col-md-5 two-col-block right-block">
        


    
        
            <pre class="prettyprint linenums:33 prettyprinted" style=""><ol class="linenums"><li value="33" class="L2"><code class="language-python"><span class="pln">p1</span><span class="pun">.</span><span class="pln">angle </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> tangent </span><span class="pun">-</span><span class="pln"> p1</span><span class="pun">.</span><span class="pln">angle</span></code></li><li class="L3"><code class="language-python"><span class="pln">p2</span><span class="pun">.</span><span class="pln">angle </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> tangent </span><span class="pun">-</span><span class="pln"> p2</span><span class="pun">.</span><span class="pln">angle</span></code></li></ol></pre>
        
    

    </div>
</div>
        
    
        
            <div class="row">
    <div class="col-md-7 two-col-block left-block">
        


    
        
            <section class="section-block block-paragraph">
                <div class="rich-text"><p>Then we need to exchange the speeds of the two particles as they transfer their energy to on another. We can do this in a single line by constructing a tuple.</p></div>
            </section>
        
    

    </div>
    <div class="col-md-5 two-col-block right-block">
        


    
        
            <pre class="prettyprint linenums:35 prettyprinted" style=""><ol class="linenums"><li value="35" class="L4"><code class="language-python"><span class="pun">(</span><span class="pln">p1</span><span class="pun">.</span><span class="pln">speed</span><span class="pun">,</span><span class="pln"> p2</span><span class="pun">.</span><span class="pln">speed</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">p2</span><span class="pun">.</span><span class="pln">speed</span><span class="pun">,</span><span class="pln"> p1</span><span class="pun">.</span><span class="pln">speed</span><span class="pun">)</span></code></li></ol></pre>
        
    

    </div>
</div>
        
    
        
            <div class="row">
    <div class="col-md-7 two-col-block left-block">
        


    
        
            <section class="section-block block-paragraph">
                <div class="rich-text"><p>Note that writing the exchange as two lines <b>does not work</b>. The reason this doesn't work, as you may have realised, is that when we come to assign <b>p2.speed</b> on the second line, we are assigning it to the new value of <b>p1.speed</b>, which we have already made equal to <b>p2.speed</b>. Constructing an tuple, which is immutable, allows us to avoid this problem.</p></div>
            </section>
        
    

    </div>
    <div class="col-md-5 two-col-block right-block">
        


    
        
            <pre class="prettyprint linenums:35 prettyprinted" style=""><ol class="linenums"><li value="35" class="L4"><code class="language-python"><span class="pln">p1</span><span class="pun">.</span><span class="pln">speed </span><span class="pun">=</span><span class="pln"> p2</span><span class="pun">.</span><span class="pln">speed</span></code></li><li class="L5"><code class="language-python"><span class="pln">p2</span><span class="pun">.</span><span class="pln">speed </span><span class="pun">=</span><span class="pln"> p1</span><span class="pun">.</span><span class="pln">speed</span></code></li></ol></pre>
        
    
        
            <section class="section-block block-paragraph">
                <div class="rich-text"><p>(Don't do this.)</p></div>
            </section>
        
    

    </div>
</div>
        
    
        
            <div class="row">
    <div class="col-md-7 two-col-block left-block">
        


    
        
            <section class="section-block block-paragraph">
                <div class="rich-text"><p>I would then add some code to reduce the energy of both particles as a result of the collision.</p></div>
            </section>
        
    

    </div>
    <div class="col-md-5 two-col-block right-block">
        


    
        
            <pre class="prettyprint linenums:36 prettyprinted" style=""><ol class="linenums"><li value="36" class="L5"><code class="language-python"><span class="pln">p1</span><span class="pun">.</span><span class="pln">speed </span><span class="pun">*=</span><span class="pln"> elasticity</span></code></li><li class="L6"><code class="language-python"><span class="pln">p2</span><span class="pun">.</span><span class="pln">speed </span><span class="pun">*=</span><span class="pln"> elasticity</span></code></li></ol></pre>
        
    

    </div>
</div>
        
    
        
            <h2>Sticky problem</h2>
        
    
        
            <section class="section-block block-paragraph">
                <div class="rich-text"><p>If you run the simulation now, you'll probably find that the particles stick to one another, and can even get stuck in mid air. The reason for this is that we have a discrete simulation (i.e. the time between updating the particle positions is not infinitely small). This introduces errors, which, for the most part, aren't important (though you should be aware of them).</p><p>What's happening is that when a particle collision is detected, the particles have actually overlapped slightly. When we alter their angle and speed then move them, we can't be sure that the particles are no longer overlapping (particularly because of drag, gravity and elasticity also altering their movement). If they still overlap then they will 'bounce' back the way they came, towards each other. They can then get trapped in a loop of 'internal bouncing', which gradually reduces their speed to nothing.</p></div>
            </section>
        
    
        
            <div class="row">
    <div class="col-md-7 two-col-block left-block">
        


    
        
            <section class="section-block block-paragraph">
                <div class="rich-text"><p>To avoid this problem we add some code into the <b>collide()</b> function to fudge the fact that the particles should have bounced before they overlapped. We calculate the angle between the two particles (which is 90 degrees to the tangent) and move the particles along this angle one pixel. We could work out exactly how far to move the particles along this angle, but I don't think it's worth the extra calculation. The code below moves the particles away from one another by a sufficiently large amount, and seems to work pretty well.</p></div>
            </section>
        
    

    </div>
    <div class="col-md-5 two-col-block right-block">
        


    
        
            <pre class="prettyprint linenums:43 prettyprinted" style=""><ol class="linenums"><li value="43" class="L2"><code class="language-python"><span class="pln">angle </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0.5</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> math</span><span class="pun">.</span><span class="pln">pi </span><span class="pun">+</span><span class="pln"> tangent</span></code></li><li class="L3"><code class="language-python"><span class="pln">p1</span><span class="pun">.</span><span class="pln">x </span><span class="pun">+=</span><span class="pln"> math</span><span class="pun">.</span><span class="pln">sin</span><span class="pun">(</span><span class="pln">angle</span><span class="pun">)</span></code></li><li class="L4"><code class="language-python"><span class="pln">p1</span><span class="pun">.</span><span class="pln">y </span><span class="pun">-=</span><span class="pln"> math</span><span class="pun">.</span><span class="pln">cos</span><span class="pun">(</span><span class="pln">angle</span><span class="pun">)</span></code></li><li class="L5"><code class="language-python"><span class="pln">p2</span><span class="pun">.</span><span class="pln">x </span><span class="pun">-=</span><span class="pln"> math</span><span class="pun">.</span><span class="pln">sin</span><span class="pun">(</span><span class="pln">angle</span><span class="pun">)</span></code></li><li class="L6"><code class="language-python"><span class="pln">p2</span><span class="pun">.</span><span class="pln">y </span><span class="pun">+=</span><span class="pln"> math</span><span class="pun">.</span><span class="pln">cos</span><span class="pun">(</span><span class="pln">angle</span><span class="pun">)</span></code></li></ol></pre>
        
    

    </div>
</div>
        
    
        
            <section class="section-block block-paragraph">
                <div class="rich-text"><p>Now the particles should bounce off one another cleanly</p></div>
            </section>
        
    
        
            <section class="section-block block-html">
                <iframe width="425" height="344" src="./Collisions_files/LI94fmOgjsE.html" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen=""></iframe>
            </section>
        
    

    </article>

    

    <div>
        <div id="comments-wrapper">
            
                <h2>Comments (20)</h2>
                


<div id="comments-None" data-object-id="None" class="comments ">
  

        <div id="c144" class="comment-item">
          
            
              <h4>
                
                  
                  Nathan Chapman
                  <span class="comment-date">on 16 Dec 2010, 1:33 a.m.</span>
                  
                  
                
              </h4>

              <div class="comment-text"><p>Thanks for these tutorials, I've been following through and they're very good.</p>

<p>One thing though: above where you have the code the "fudge" the collision happening before the particles intersected, I'm throwing an error whereby it doesn't know what "angle" is.</p>

<p>p1.x += math.sin(angle)<br>p1.y -= math.cos(angle)<br>p2.x -= math.sin(angle)<br>p2.y += math.cos(angle)</p>

<p>Here is throws the following error if I run that code exactly:</p>

<p>NameError: global name 'angle' is not defined</p>

<p>What have I missed / done wrong?</p>

<p>Thanks, Nathan.</p></div>
          
        </div>


        <div id="c145" class="comment-item">
          
            
              <h4>
                
                  
                  Peter
                  <span class="comment-date">on 16 Dec 2010, 1:10 p.m.</span>
                  
                  
                
              </h4>

              <div class="comment-text"><p>No, sorry, that's my fault. Looks like I forgot to say to add the line:</p>

<p>33. angle = 0.5 * math.pi + tangent<br>(Add after the line defining the tangent.)</p>

<p>If you look at the attached file below the video, it will give you the final program, which should work. I'll update the tutorial to include it.</p></div>
          
        </div>


        <div id="c146" class="comment-item">
          
            
              <h4>
                
                  
                  Nathan Chapman
                  <span class="comment-date">on 18 Dec 2010, 12:16 a.m.</span>
                  
                  
                
              </h4>

              <div class="comment-text"><p>Oh, wonderful, thanks!</p>

<p>And yes, it works very well now!</p></div>
          
        </div>


        <div id="c147" class="comment-item">
          
            
              <h4>
                
                  
                  nf3
                  <span class="comment-date">on 29 Jan 2011, 1:29 a.m.</span>
                  
                  
                
              </h4>

              <div class="comment-text"><p>hi, advancing in this great tutorial :)</p>

<p>found another error. line 108 in 'collision testing' reads:</p>

<p>108. collide(particle1, particle2)</p>

<p>but it should be</p>

<p>108. collide(particle, particle2)</p>

<p>because the outer loop delivers 'particle', not 'particle1'</p>

<p>ps. in another comment you refer to a link with the complete code, but i cant see it (on Firefox). Anyway, I find it better to follow the tutorial typing or pasting things in place, because it makes me pay more attention.</p></div>
          
        </div>


        <div id="c148" class="comment-item">
          
            
              <h4>
                
                  
                  Peter
                  <span class="comment-date">on 29 Jan 2011, 3:27 p.m.</span>
                  
                  
                
              </h4>

              <div class="comment-text"><p>Thanks, I've fixed it. I appreciate you taking the time to go through it all. It is definitely better that simply copying and pasting the code. And it's a good test to see whether I've actually written about all the changes (I think I sometimes rearrange code without mentioning it).</p>

<p>Between the video and the comments there should be an attachment of the final code called particle_tutorial_8.txt. I can see it in Firefox, I'm not sure why you can't.</p></div>
          
        </div>


        <div id="c149" class="comment-item">
          
            
              <h4>
                
                  
                  Peter
                  <span class="comment-date">on 6 Feb 2011, 11:50 a.m.</span>
                  
                  
                
              </h4>

              <div class="comment-text"><p>Sorry, I realised that the permissions were set so only I could see the attached files, they should now be visible.</p></div>
          
        </div>


        <div id="c150" class="comment-item">
          
            
              <h4>
                
                  
                  Charlie
                  <span class="comment-date">on 18 Feb 2012, 7:18 a.m.</span>
                  
                  
                
              </h4>

              <div class="comment-text"><p>Thanks very much for these great tutorials.  Really appreciate them a lot and hope you wlll keep adding to these python based tutorials.</p>

<p>Thanks again.</p></div>
          
        </div>


        <div id="c151" class="comment-item">
          
            
              <h4>
                
                  
                  Peter
                  <span class="comment-date">on 19 Feb 2012, 4:50 p.m.</span>
                  
                  
                
              </h4>

              <div class="comment-text"><p>Thanks Charlie. I have ideas for quite a few more Python tutorials, I just need to find time to write them.</p></div>
          
        </div>


        <div id="c152" class="comment-item">
          
            
              <h4>
                
                  
                  Jatra
                  <span class="comment-date">on 3 Oct 2012, 10:06 p.m.</span>
                  
                  
                
              </h4>

              <div class="comment-text"><p>When i run particle_tutorial_7, the circles have only the boundaries as color blue. but when i run particle_tutorial_8, the entire circle including the inside is blue. where did this change come from?</p></div>
          
        </div>


        <div id="c153" class="comment-item">
          
            
              <h4>
                
                  
                  Peter
                  <span class="comment-date">on 3 Oct 2012, 11:19 p.m.</span>
                  
                  
                
              </h4>

              <div class="comment-text"><p>The change is in the Particle class where self.thickness changes from 1 to 0. I decided it was easier to see the particles that way, I should have mentioned it somewhere.</p></div>
          
        </div>


        <div id="c154" class="comment-item">
          
            
              <h4>
                
                  
                  HenryChen
                  <span class="comment-date">on 15 Nov 2012, 11:45 a.m.</span>
                  
                  
                
              </h4>

              <div class="comment-text"><p>the momentum is not conserved</p></div>
          
        </div>


        <div id="c155" class="comment-item">
          
            
              <h4>
                
                  
                  Andy
                  <span class="comment-date">on 16 May 2013, 9:12 p.m.</span>
                  
                  
                
              </h4>

              <div class="comment-text"><p>Hi Peter,</p>

<p>I know this was a while ago, but you said : "To reflect the angle of the particles on this surface, we subtract their<br>current angle from two times the tangent. I'll have to explain the<br>logic behind this at a later date."</p>

<p>Well, this was the only step I didn't understand, and it's the only one you didn't explain! Could you help me out?</p>

<p>Thank you very much. Your tutorials present well-explained, elegant solutions to many problems that I've been banging my head against in Python for a while now. The amount of time I spent struggling with the signs of arctan(x) and its special case x=0 is frankly upsetting, but of course - atan2()! Python has a simple solution for everything. I love it!</p></div>
          
        </div>


        <div id="c156" class="comment-item">
          
            
              <h4>
                
                  
                  Peter
                  <span class="comment-date">on 7 Jul 2013, 7:45 p.m.</span>
                  
                  
                
              </h4>

              <div class="comment-text"><p>Hi Andy,</p>

<p>You're right. I meant to properly explain this ages and I still haven't gotten around to it. One of these days I'll go back through this tutorial and finish off, I hope.</p>

<p>I also spent a lot of time messing about with signs and special cases before discovering atan2. It's clearly a common enough problem that they made a specific function for it.</p></div>
          
        </div>


        <div id="c157" class="comment-item">
          
            
              <h4>
                
                  
                  Adam
                  <span class="comment-date">on 12 Feb 2014, 2:47 p.m.</span>
                  
                  
                
              </h4>

              <div class="comment-text"><p>Hi Peter,</p>

<p>Great tutorial. I'm trying to build a molecular fluid dynamics simulation at the moment, and your work here is tremendously helpful. (For example, before I found your tutorial I spent about two hours struggling with atan before finding atan2. I was trying to come up with a solution to "sticky collisions" when I found your tutorial. Major time saver!)</p>

<p>One problem I am running into that you don't address is collision detection efficiency for large numbers of particles. I am currently doing this as a nested loop over all pairs, just as you suggest. This is a O(n^2) algorithm that quickly uses up available processing power for large n.</p>

<p>It turns out that there has been a lot of work done to improve collision detection, resulting in two main alternatives, "sweep and prune" and "regular grid". These techniques can tremendously reduce processing time for large numbers of particles, approaching O(n log(n)) or O(n), respectively.</p>

<p>If you are interested in this, http://umumble.com/blogs/algorithm/403/ is a great place to start. My own simulation will require 1000+ particles, so such an algorithm will be necessary for me.  It may be of interest to some of your other readers as well!</p>

<p>Thanks for your great work,<br>Adam</p></div>
          
        </div>


        <div id="c158" class="comment-item">
          
            
              <h4>
                
                  
                  MestreLion
                  <span class="comment-date">on 8 Aug 2014, 4:40 a.m.</span>
                  
                  
                
              </h4>

              <div class="comment-text"><p>Regarding the normal angle, you said "To reflect the angle of the particles on this surface, we subtract their<br>current angle from two times the tangent. I'll have to explain the<br>logic behind this at a later date"</p>

<p>Actually this is quite trivial to explain: physics say the exit and entry angles are symmetrical to the tangent angle (and thus also symmetrical to the normal angle). So IN-N = N-OUT,  which means OUT = 2N - IN. And that's where those formulas came from:</p>

<p>p1.angle = 2*tangent - p1.angle</p>

<p>p2.angle = 2*tangent - p2.angle</p>

<p>Just a note: If I understood correctly, what you called "tangent angle" is actually the normal angle, as the distance between the circle centers (used to calculate it) is the normal of the reflection line (the line tanget to the circles). They are perpendicular to each other, so the either one works, but it's nice to have a consistent nomenclature.</p></div>
          
        </div>


        <div id="c159" class="comment-item">
          
            
              <h4>
                
                  
                  MestreLion
                  <span class="comment-date">on 8 Aug 2014, 12:47 p.m.</span>
                  
                  
                
              </h4>

              <div class="comment-text"><p>Peter , your articles are amazing! Elegant solutions, pythonic style, congrats!!! And thanks a LOT!</p>

<p>(that math.hipot() was sweet! So much better than spawning sqrt(x**2 + y**2) everywhere :)</p></div>
          
        </div>


        <div id="c361" class="comment-item">
          
            
              <h4>
                
                  
                  Anonymous
                  <span class="comment-date">on 3 May 2015, 4:58 a.m.</span>
                  
                  
                
              </h4>

              <div class="comment-text"><p>The 3-body problem is solvable... And so is the n-body problem...</p></div>
          
        </div>


        <div id="c362" class="comment-item">
          
            
              <h4>
                
                  
                  Anonymous
                  <span class="comment-date">on 5 May 2015, 9:57 p.m.</span>
                  
                  
                
              </h4>

              <div class="comment-text"><p>I keep getting an attribute error in the collide function:</p>

<p>    p2.pos_x -= math.sin(angle)<br>AttributeError: 'float' object has no attribute 'pos_x'</p></div>
          
        </div>


        <div id="c363" class="comment-item">
          
            
              <h4>
                
                  
                  Anonymous
                  <span class="comment-date">on 15 Dec 2016, 3:09 p.m.</span>
                  
                  
                
              </h4>

              <div class="comment-text"><p>Doesn't this only work if the circles are both moving "towards" the tangent line?</p>

<p>How should a circle react if it is already moving away from the line?  For example, in a rear-end collision, this algorithm wouldn't apply, right?</p>

<p>I'm trying to figure out how to deal with these types of collisions and I'm going crazy.</p></div>
          
        </div>


        <div id="c1692" class="comment-item">
          
            
              <h4>
                
                  
                  TheRainHarvester on YouTube
                  <span class="comment-date">on 4 Sep 2019, 11:33 p.m.</span>
                  
                  
                
              </h4>

              <div class="comment-text"><p>The "angle of collision diagram" makes no sense because it means car #1 could t-bone another car 2, and car 2 wouldn't be affected.</p></div>
          
        </div>

</div>


            
          </div>

         
    </div>

    

    <div class="row">
    <div class="col-4">
        
            <a href="https://www.petercollingridge.co.uk/tutorials/pygame-physics-simulation/mouse-interactions/">
                <span class="naviagation-arrow"><i class="fa fa-caret-left" aria-hidden="true"></i></span>
                <span class="navigation-name">Mouse interactions</span>
            </a>
        
    </div>
    <div class="col-4 parent-page-link">
        <a href="https://www.petercollingridge.co.uk/tutorials/pygame-physics-simulation/">
            
                Pygame physics simulation
            
        </a>
    </div>
    <div class="col-4 next-page-link">
        
            <a href="https://www.petercollingridge.co.uk/tutorials/pygame-physics-simulation/mass/">
                <span class="navigation-name">Mass</span>
                <span class="naviagation-arrow"><i class="fa fa-caret-right" aria-hidden="true"></i></span>
            </a>
        
    </div>
</div>

</div>
            </main>

            <div class="footer"></div>
        </div>

        
        <!-- Bootstrap core JavaScript -->
        <script type="text/javascript" async="" src="./Collisions_files/ga.js.Download"></script><script src="./Collisions_files/jquery-3.3.1.min.js.Download" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
        <script src="./Collisions_files/popper.min.js.Download" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh" crossorigin="anonymous"></script>
        <script src="./Collisions_files/bootstrap.min.js.Download" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ" crossorigin="anonymous"></script>

        
    <script type="text/javascript" src="./Collisions_files/ajaxcomments.js.Download"></script>

        
    

    

    

    


        <script type="text/javascript">
          var _gaq = _gaq || [];
          _gaq.push(["_setAccount", "UA-13015193-1"]);
          _gaq.push(["_trackPageview"]);
          (function() {
            var ga = document.createElement('script');
            ga.type = 'text/javascript';
            ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
          })();
      </script>
    

</body></html>